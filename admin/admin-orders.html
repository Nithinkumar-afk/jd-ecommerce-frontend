<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JD Admin – Orders</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#000;
  --card:#111;
  --border:#222;
  --text:#fff;
  --muted:#cbd5f5;
  --accent:orange;
}

*{box-sizing:border-box}

body{
  background:var(--bg);
  color:var(--text);
  font-family:Poppins,sans-serif;
  margin:0;
  opacity:0;
  transition:opacity .35s ease;
}

body.loaded{opacity:1}

header{
  padding:18px 20px;
  font-size:22px;
  font-weight:600;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header a{
  color:#fff;
  text-decoration:none;
  font-size:14px;
  opacity:.85;
}

.filters{
  display:flex;
  gap:10px;
  padding:16px 20px;
  flex-wrap:wrap;
}

.filters button{
  padding:10px 16px;
  border:none;
  border-radius:999px;
  background:#111;
  color:#fff;
  cursor:pointer;
}

.filters button.active{
  background:orange;
  color:#000;
}

.container{
  padding:20px;
  max-width:1200px;
  margin:auto;
}

.order{
  background:#111;
  padding:16px;
  border-radius:16px;
  margin-bottom:16px;
  border:1px solid #222;
}

.status{
  font-weight:600;
  margin-top:6px;
}

.Placed{color:orange}
.Shipped{color:#38bdf8}
.Delivered{color:#22c55e}
.Cancelled{color:#ef4444}

.items{
  margin-top:10px;
  font-size:14px;
  color:#cbd5f5;
  line-height:1.6;
}

.actions{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:14px;
}

.actions button{
  padding:8px 16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}

.actions button:disabled{
  opacity:.4;
  cursor:not-allowed;
}

.ship{background:#0ea5e9}
.deliver{background:#22c55e}
.cancel{background:#ef4444}
.delete{background:#6b7280}

@media(max-width:600px){
  header{font-size:18px}
  .filters{overflow-x:auto;flex-wrap:nowrap}
  .actions button{width:100%}
}
</style>
</head>

<body>

<header>
  <span>JD Admin – Orders</span>
  <a href="admin-dashboard.html">← Dashboard</a>
</header>

<div class="filters">
  <button class="active" onclick="setFilter('ALL',this)">All</button>
  <button onclick="setFilter('Placed',this)">Placed</button>
  <button onclick="setFilter('Shipped',this)">Shipped</button>
  <button onclick="setFilter('Delivered',this)">Delivered</button>
  <button onclick="setFilter('Cancelled',this)">Cancelled</button>
</div>

<div class="container" id="orders">Loading…</div>

<script src="../config.js"></script>
<script>
"use strict";

document.body.classList.add("loaded");

const API = window.APP_CONFIG.API_BASE;
let allOrders = [];
let currentFilter = "ALL";

/* ================= API FETCH ================= */
async function apiFetch(url, options = {}){
  const res = await fetch(url,{
    ...options,
    headers:{
      "Content-Type":"application/json",
      ...(options.headers || {})
    }
  });

  const data = await res.json();
  if(!res.ok) throw data;
  return data;
}

/* ================= LOAD ORDERS ================= */
async function loadOrders(){
  try{
    allOrders = await apiFetch(`${API}/api/orders/admin`);
    renderOrders();
  }catch(err){
    document.getElementById("orders").innerHTML =
      "<p style='color:red'>Failed to load orders</p>";
  }
}

/* ================= UPDATE STATUS ================= */
async function updateStatus(id,status){
  try{
    await apiFetch(`${API}/api/orders/${id}/status`,{
      method:"PUT",
      body:JSON.stringify({status})
    });
    loadOrders();
  }catch(e){
    alert(e.error || "Status update failed");
  }
}

/* ================= DELETE ================= */
async function deleteOrder(id){
  if(!confirm("Delete this order?")) return;
  try{
    await apiFetch(`${API}/api/orders/${id}`,{method:"DELETE"});
    loadOrders();
  }catch{
    alert("Delete failed");
  }
}

/* ================= FILTER ================= */
function setFilter(status,btn){
  currentFilter = status;
  document.querySelectorAll(".filters button")
    .forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  renderOrders();
}

/* ================= RENDER ================= */
function renderOrders(){
  const div = document.getElementById("orders");
  div.innerHTML = "";

  const list = currentFilter === "ALL"
    ? allOrders
    : allOrders.filter(o => o.status === currentFilter);

  if(!list.length){
    div.innerHTML = "<p>No orders found</p>";
    return;
  }

  list.forEach(o=>{
    div.innerHTML += `
      <div class="order">
        <b>Order #${o.id}</b><br>
        User ID: ${o.user_id}<br>
        Total: ₹${Number(o.total_amount).toLocaleString("en-IN")}

        <div class="status ${o.status}">${o.status}</div>

        <div class="items">
          ${(o.items || []).map(i =>
            `${i.name} × ${i.qty} (₹${i.price})`
          ).join("<br>")}
        </div>

        <div class="actions">
          <button class="ship" onclick="updateStatus(${o.id},'Shipped')" ${o.status!=="Placed"?"disabled":""}>Ship</button>
          <button class="deliver" onclick="updateStatus(${o.id},'Delivered')" ${o.status!=="Shipped"?"disabled":""}>Deliver</button>
          <button class="cancel" onclick="updateStatus(${o.id},'Cancelled')" ${o.status==="Delivered"?"disabled":""}>Cancel</button>
          <button class="delete" onclick="deleteOrder(${o.id})">Delete</button>
        </div>
      </div>
    `;
  });
}

loadOrders();
</script>

</body>
</html>
