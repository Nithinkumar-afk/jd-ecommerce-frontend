<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin ‚Äì Users | JD</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#000;
  --card:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.15);
  --text:#e5e7eb;
  --muted:#94a3b8;
}

*{ box-sizing:border-box; margin:0; padding:0 }

body{
  font-family:Poppins,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* HEADER */
header{
  padding:18px 22px;
  background:var(--card);
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:14px;
}

header h2{
  font-size:18px;
  font-weight:600;
}

header a{
  color:#fff;
  text-decoration:none;
  font-size:14px;
  opacity:.9;
}

/* NAV */
.nav{
  display:flex;
  gap:12px;
  padding:16px 22px;
  flex-wrap:wrap;
}

.nav a{
  text-decoration:none;
  color:#fff;
  padding:12px 18px;
  border-radius:16px;
  background:var(--card);
  border:1px solid var(--border);
  font-size:14px;
}

/* SECTION */
.section{
  padding:24px 22px;
  max-width:1200px;
  margin:auto;
}

.section h3{
  margin-bottom:16px;
  font-size:16px;
  font-weight:600;
}

/* USER CARD */
.user-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:20px;
  padding:18px;
  margin-bottom:16px;
  display:flex;
  gap:18px;
  align-items:center;
}

.user-img{
  width:80px;
  height:80px;
  border-radius:50%;
  background:#020617;
  overflow:hidden;
  flex-shrink:0;
  border:1px solid var(--border);
  cursor:pointer;
}

.user-img img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.user-info p{
  margin-bottom:6px;
  font-size:14px;
  color:var(--muted);
}

.user-info strong{
  color:#fff;
}

/* ================= IMAGE POPUP ================= */
.img-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:200;
}

.img-modal img{
  max-width:90%;
  max-height:90%;
  border-radius:20px;
  border:1px solid var(--border);
  animation:zoom .25s ease;
}

.img-modal span{
  position:absolute;
  top:20px;
  right:26px;
  font-size:26px;
  cursor:pointer;
}

@keyframes zoom{
  from{ transform:scale(.85); opacity:0 }
  to{ transform:scale(1); opacity:1 }
}

/* MOBILE */
@media(max-width:600px){
  header{ flex-direction:column; align-items:flex-start }
  header h2{ font-size:16px }

  .nav a{ flex:1; text-align:center }

  .section{ padding:16px 14px }

  .user-card{
    flex-direction:column;
    align-items:flex-start;
    gap:14px;
  }

  .user-img{ width:70px; height:70px }
  .user-info p{ font-size:13px }
}
</style>
</head>

<body>

<header>
  <h2>JD Admin ‚Äì Users</h2>
  <a href="admin-dashboard.html">‚Üê Dashboard</a>
</header>

<div class="nav">
  <a href="admin-products.html">üì¶ Products</a>
  <a href="admin-orders.html">üìë Orders</a>
  <a href="admin-users.html">üë• Users</a>
</div>

<div class="section">
  <h3>All Users</h3>
  <div id="usersList">Loading users...</div>
</div>

<!-- IMAGE POPUP -->
<div class="img-modal" id="imgModal">
  <span onclick="closeImg()">‚úï</span>
  <img id="modalImg">
</div>

<script src="../config.js"></script>
<script>
"use strict";

/* ================= CONFIG ================= */
const API_BASE = window.APP_CONFIG.API_BASE;
const FALLBACK_IMG = "https://via.placeholder.com/80?text=User";
const usersList = document.getElementById("usersList");

/* ================= IMAGE POPUP ================= */
const imgModal = document.getElementById("imgModal");
const modalImg = document.getElementById("modalImg");

function openImg(src){
  modalImg.src = src;
  imgModal.style.display = "flex";
}
function closeImg(){
  imgModal.style.display = "none";
}
imgModal.onclick = e => {
  if(e.target === imgModal) closeImg();
};

/* ================= SMOOTH IMAGE LOADER ================= */
function loadUserImage(imgEl, src){
  imgEl.style.opacity = "0";
  imgEl.style.transition = "opacity .25s ease";

  const pre = new Image();
  pre.src = src;

  pre.onload = () => {
    imgEl.src = src;
    requestAnimationFrame(() => imgEl.style.opacity = "1");
  };

  pre.onerror = () => {
    imgEl.src = FALLBACK_IMG;
    imgEl.style.opacity = "1";
  };
}

/* ================= LOAD USERS ================= */
async function loadUsers() {
  usersList.innerHTML = "<p style='opacity:.6'>Loading users...</p>";

  try {
    const res = await fetch(
      `${API_BASE}/api/admin/users?ts=${Date.now()}`,
      { cache: "no-store" }
    );

    if (!res.ok) throw new Error("API failed");

    const users = await res.json();
    usersList.innerHTML = "";

    if (!users.length) {
      usersList.innerHTML = "<p style='opacity:.6'>No users found</p>";
      return;
    }

    users.forEach((u, i) => {
      const imgId = `userImg_${i}`;
      const imgSrc = u.image
        ? `${API_BASE}${u.image}?t=${Date.now()}`
        : FALLBACK_IMG;

      usersList.insertAdjacentHTML("beforeend", `
        <div class="user-card">
          <div class="user-img" onclick="openImg('${imgSrc}')">
            <img id="${imgId}" src="${FALLBACK_IMG}">
          </div>
          <div class="user-info">
            <p><strong>${u.name || "Guest"}</strong></p>
            <p>üìû ${u.phone || "-"}</p>
            <p>üè† ${u.address || "-"}</p>
          </div>
        </div>
      `);

      const imgEl = document.getElementById(imgId);
      loadUserImage(imgEl, imgSrc);
    });

  } catch (err) {
    console.error(err);
    usersList.innerHTML =
      "<p style='color:#ff6b6b'>Failed to load users</p>";
  }
}

/* ================= INIT ================= */
loadUsers();
</script>

</body>
</html>
